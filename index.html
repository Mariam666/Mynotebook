<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Notebook</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'EB Garamond', 'Adobe Garamond Pro', 'Garamond', 'Times New Roman', serif;
        background-color: #f9fafb;
        min-height: 100vh;
        padding: 1.5rem;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    h1 {
        font-size: 1.875rem;
        font-weight: bold;
        color: #1f2937;
        margin-bottom: 1rem;
    }
    
    .dashboard-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .stat-card {
        background: white;
        padding: 1rem;
        border-radius: 0.5rem;
        border: 2px solid #e5e7eb;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .stat-card:hover {
        background-color: #f3f4f6;
    }
    
    .nav-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }
    
    .tab-button {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        padding: 1rem;
        border-radius: 0.5rem;
        border: 2px solid #e5e7eb;
        background: white;
        color: #6b7280;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .tab-button:hover {
        background-color: #f3f4f6;
    }
    
    .tab-button.active {
        background-color: #dbeafe;
        color: #1d4ed8;
        border-color: #93c5fd;
    }
    
    .content-area {
        background: white;
        padding: 1.5rem;
        border-radius: 0.5rem;
        border: 1px solid #e5e7eb;
    }
    
    .btn {
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        border: none;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .btn-primary {
        background-color: #3b82f6;
        color: white;
    }
    
    .btn-green {
        background-color: #10b981;
        color: white;
    }
    
    .btn-purple {
        background-color: #8b5cf6;
        color: white;
    }
    
    .btn-delete {
        background-color: #ef4444;
        color: white;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
    }
    
    input, textarea, select {
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        font-family: inherit;
    }
    
    textarea {
        width: 100%;
        height: 8rem;
        resize: vertical;
    }
    
    .hidden {
        display: none;
    }
    
    .input-row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .item-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .list-item {
        padding: 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 0.375rem;
        background: white;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .list-item.completed {
        background-color: #f0fdf4;
        text-decoration: line-through;
        color: #6b7280;
    }
</style>
```

</head>
<body>
    <div class="container">
        <h1>Notebook</h1>

```
    <!-- Dashboard Stats -->
    <div id="dashboard-stats" class="dashboard-stats">
        <div class="stat-card" onclick="showTab('calories')">
            <div style="text-align: center;">
                <div style="font-size: 0.875rem; font-weight: 500;">üî• Calories</div>
                <div style="font-size: 0.75rem; color: #2563eb;" id="calories-today">0 cal today</div>
                <div style="font-size: 0.75rem; color: #8b5cf6;" id="protein-today">0g protein</div>
                <div style="font-size: 0.75rem; color: #f59e0b;" id="balance-today">Enter burned calories</div>
            </div>
        </div>
        
        <div class="stat-card" onclick="showTab('spending')">
            <div style="text-align: center;">
                <div style="font-size: 0.875rem; font-weight: 500;">üí∞ Spending</div>
                <div style="font-size: 0.75rem; color: #2563eb;" id="spending-week">$0 this week</div>
            </div>
        </div>
    </div>
    
    <!-- Big Home Button -->
    <div style="margin-bottom: 1rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <button class="tab-button active" onclick="showTab('dashboard')" id="tab-dashboard" 
                style="grid-column: 1 / -1; padding: 1.5rem; font-size: 1.125rem;">
            <span style="font-size: 2rem;">üè†</span>
            <span style="font-weight: 600;">Home</span>
        </button>
    </div>
    
    <!-- Navigation Grid - 2 rows of 4 boxes -->
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1.5rem;">
        <!-- Row 1 -->
        <button class="tab-button" onclick="showTab('notes')" id="tab-notes">
            <span style="font-size: 1.5rem;">üìù</span>
            <span>Notes</span>
        </button>
        
        <button class="tab-button" onclick="showTab('read')" id="tab-read">
            <span style="font-size: 1.5rem;">üìö</span>
            <span>Read</span>
        </button>
        
        <button class="tab-button" onclick="showTab('listen')" id="tab-listen">
            <span style="font-size: 1.5rem;">üéµ</span>
            <span>Listen</span>
        </button>
        
        <button class="tab-button" onclick="showTab('watch')" id="tab-watch">
            <span style="font-size: 1.5rem;">üì∫</span>
            <span>Watch</span>
        </button>
        
        <!-- Row 2 -->
        <button class="tab-button" onclick="showTab('cook')" id="tab-cook">
            <span style="font-size: 1.5rem;">üç≥</span>
            <span>Cook</span>
        </button>
        
        <button class="tab-button" onclick="showTab('make')" id="tab-make">
            <span style="font-size: 1.5rem;">üî®</span>
            <span>Make</span>
        </button>
        
        <button class="tab-button" onclick="showTab('calories')" id="tab-calories">
            <span style="font-size: 1.5rem;">üî•</span>
            <span>Calories</span>
        </button>
        
        <button class="tab-button" onclick="showTab('spending')" id="tab-spending">
            <span style="font-size: 1.5rem;">üí∞</span>
            <span>Spending</span>
        </button>
    </div>

    <!-- Sync Buttons -->
    <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; justify-content: center;">
        <button class="btn" onclick="downloadData()" style="background: #10b981; color: white;">
            üì• Download My Data
        </button>
        <button class="btn" onclick="document.getElementById('upload-input').click()" style="background: #8b5cf6; color: white;">
            üì§ Upload My Data
        </button>
        <input type="file" id="upload-input" accept=".json" style="display: none;" onchange="uploadData(event)">
    </div>
    
    <!-- Content Area -->
    <div id="content-area" class="content-area hidden">
        <!-- Dynamic content will be loaded here -->
    </div>
</div>

<script>
    // Data storage
    let appData = {
        lists: { read: [], listen: [], watch: [], cook: [], make: [] },
        notes: [],
        calories: [],
        caloriesBurned: [],
        spending: []
    };

    // Load data from localStorage
    function loadData() {
        const saved = localStorage.getItem('notebookData');
        if (saved) {
            appData = JSON.parse(saved);
        }
    }

    // Save data to localStorage
    function saveData() {
        localStorage.setItem('notebookData', JSON.stringify(appData));
    }

    // Show specific tab
    function showTab(tabName) {
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');

        if (tabName === 'dashboard') {
            document.getElementById('dashboard-stats').style.display = 'grid';
            document.getElementById('content-area').classList.add('hidden');
            updateDashboard();
        } else {
            document.getElementById('dashboard-stats').style.display = 'none';
            document.getElementById('content-area').classList.remove('hidden');
            loadTabContent(tabName);
        }
    }

    // Load content for specific tab
    function loadTabContent(tabName) {
        if (['read', 'listen', 'watch', 'cook', 'make'].includes(tabName)) {
            loadListTab(tabName);
        } else if (tabName === 'notes') {
            loadNotesTab();
        } else if (tabName === 'calories') {
            loadCaloriesTab();
        } else if (tabName === 'spending') {
            loadSpendingTab();
        }
    }

    // Load list tab
    function loadListTab(listName) {
        const items = appData.lists[listName] || [];
        const contentArea = document.getElementById('content-area');
        
        if (listName === 'read') {
            // Special layout for READ with category dropdown and link field
            contentArea.innerHTML = 
                '<h2>' + listName.toUpperCase() + '</h2>' +
                '<div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; align-items: center;">' +
                    '<input type="text" id="new-item-' + listName + '" placeholder="Add new read item..." style="flex: 2; min-width: 200px;">' +
                    '<input type="url" id="read-link-input" placeholder="Link (optional)" style="flex: 1; min-width: 140px;">' +
                    '<select id="read-category-input" style="flex: 0 0 auto; min-width: 80px;">' +
                        '<option value="book">Book</option>' +
                        '<option value="essay">Essay</option>' +
                        '<option value="poem">Poem</option>' +
                    '</select>' +
                    '<input type="date" id="list-date-input-' + listName + '" value="' + new Date().toISOString().split('T')[0] + '" style="flex: 0 0 auto;">' +
                    '<button class="btn btn-primary" onclick="addListItem(\'' + listName + '\')" style="flex: 0 0 auto;">Add</button>' +
                '</div>' +
                '<div class="item-list">' +
                    items
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .map(item => {
                            let categoryColor = '#f3f4f6'; // default gray
                            let categoryTextColor = '#374151';
                            if (item.category === 'book') {
                                categoryColor = '#dbeafe'; // blue
                                categoryTextColor = '#1d4ed8';
                            } else if (item.category === 'essay') {
                                categoryColor = '#f0fdf4'; // green
                                categoryTextColor = '#059669';
                            } else if (item.category === 'poem') {
                                categoryColor = '#faf5ff'; // purple
                                categoryTextColor = '#7c3aed';
                            }
                            
                            return '<div class="list-item' + (item.completed ? ' completed' : '') + '" style="background: ' + categoryColor + ';">' +
                                '<input type="checkbox"' + (item.completed ? ' checked' : '') + ' onchange="toggleListItem(\'' + listName + '\', ' + item.id + ')">' +
                                '<span style="flex: 1; cursor: pointer;" onclick="editListItem(\'' + listName + '\', ' + item.id + ')">' + 
                                    item.content + 
                                    '<br><small style="color: ' + categoryTextColor + '; font-weight: 600;">' + (item.category || 'book').toUpperCase() + '</small>' +
                                    '<br><small style="color: #6b7280;">' + new Date(item.date).toLocaleDateString() + '</small>' +
                                '</span>' +
                                '<div style="display: flex; align-items: center; gap: 0.5rem;">' +
                                    (item.link ? '<button class="btn" onclick="window.open(\'' + item.link + '\', \'_blank\')" style="background: #10b981; color: white; padding: 0.25rem 0.5rem; font-size: 0.75rem;">üîó Open</button>' : '') +
                                    '<button class="btn btn-delete" onclick="deleteListItem(\'' + listName + '\', ' + item.id + ')">Delete</button>' +
                                '</div>' +
                            '</div>';
                        }).join('') +
                '</div>';
        } else {
            // Regular layout for other lists
            contentArea.innerHTML = 
                '<h2>' + listName.toUpperCase() + '</h2>' +
                '<div style="display: grid; grid-template-columns: 1fr auto auto; gap: 0.5rem; margin-bottom: 1rem;">' +
                    '<input type="text" id="new-item-' + listName + '" placeholder="Add new ' + listName + ' item...">' +
                    '<input type="date" id="list-date-input-' + listName + '" value="' + new Date().toISOString().split('T')[0] + '">' +
                    '<button class="btn btn-primary" onclick="addListItem(\'' + listName + '\')">Add</button>' +
                '</div>' +
                '<div class="item-list">' +
                    items
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .map(item => 
                        '<div class="list-item' + (item.completed ? ' completed' : '') + '">' +
                            '<input type="checkbox"' + (item.completed ? ' checked' : '') + ' onchange="toggleListItem(\'' + listName + '\', ' + item.id + ')">' +
                            '<span style="flex: 1; cursor: pointer;" onclick="editListItem(\'' + listName + '\', ' + item.id + ')">' + 
                                item.content + 
                                '<br><small style="color: #6b7280;">' + new Date(item.date).toLocaleDateString() + '</small>' +
                            '</span>' +
                            '<button class="btn btn-delete" onclick="deleteListItem(\'' + listName + '\', ' + item.id + ')">Delete</button>' +
                        '</div>'
                    ).join('') +
                '</div>';
        }
    }

    function addListItem(listName) {
        const input = document.getElementById('new-item-' + listName);
        const dateInput = document.getElementById('list-date-input-' + listName);
        const content = input.value.trim();
        const date = dateInput.value;
        if (!content || !date) return;

        const newItem = {
            id: Date.now(),
            content: content,
            completed: false,
            date: date
        };

        // Add category for read items
        if (listName === 'read') {
            const categoryInput = document.getElementById('read-category-input');
            const linkInput = document.getElementById('read-link-input');
            newItem.category = categoryInput.value;
            if (linkInput.value.trim()) {
                newItem.link = linkInput.value.trim();
            }
            linkInput.value = ''; // Clear link field after adding
        }

        appData.lists[listName].push(newItem);
        saveData();
        input.value = '';
        // Keep the date for easy multiple entries
        loadListTab(listName);
    }

    function editListItem(listName, itemId) {
        const item = appData.lists[listName].find(item => item.id === itemId);
        if (!item) return;

        const newContent = prompt('Edit item:', item.content);
        if (newContent === null) return;
        
        const newDate = prompt('Edit date (YYYY-MM-DD):', item.date);
        if (newDate === null) return;

        if (newContent.trim() !== '' && newDate) {
            item.content = newContent.trim();
            item.date = newDate;
            
            // Add category editing for read items
            if (listName === 'read') {
                const newCategory = prompt('Edit category (book/essay/poem):', item.category || 'book');
                if (newCategory && ['book', 'essay', 'poem'].includes(newCategory.toLowerCase())) {
                    item.category = newCategory.toLowerCase();
                }
                
                const newLink = prompt('Edit link (optional):', item.link || '');
                if (newLink !== null) {
                    if (newLink.trim()) {
                        item.link = newLink.trim();
                    } else {
                        delete item.link; // Remove link if empty
                    }
                }
            }
            
            saveData();
            loadListTab(listName);
        }
    }

    function toggleListItem(listName, itemId) {
        const item = appData.lists[listName].find(item => item.id === itemId);
        if (item) {
            item.completed = !item.completed;
            saveData();
            loadListTab(listName);
        }
    }

    function deleteListItem(listName, itemId) {
        if (confirm('Delete this item?')) {
            appData.lists[listName] = appData.lists[listName].filter(item => item.id !== itemId);
            saveData();
            loadListTab(listName);
        }
    }

    // Load notes tab
    function loadNotesTab() {
        const contentArea = document.getElementById('content-area');
        
        contentArea.innerHTML = 
            '<h2>NOTES</h2>' +
            '<div style="margin-bottom: 1rem;">' +
                '<textarea id="new-note" placeholder="Write your note here..."></textarea>' +
                '<div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">' +
                    '<input type="date" id="note-date-input" value="' + new Date().toISOString().split('T')[0] + '" style="flex: 0 0 auto;">' +
                    '<button class="btn btn-primary" onclick="addNote()">Save Note</button>' +
                '</div>' +
            '</div>' +
            '<div>' +
                appData.notes
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .map(note => 
                    '<div style="padding: 1rem; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; margin-bottom: 0.75rem;">' +
                        '<div style="cursor: pointer; margin-bottom: 0.5rem; white-space: pre-wrap;" onclick="editNote(' + note.id + ')">' + note.content + '</div>' +
                        '<div style="display: flex; justify-content: space-between;">' +
                            '<small style="color: #6b7280;">' + new Date(note.date).toLocaleDateString() + '</small>' +
                            '<button class="btn btn-delete" onclick="deleteNote(' + note.id + ')">Delete</button>' +
                        '</div>' +
                    '</div>'
                ).join('') +
            '</div>';
    }

    function addNote() {
        const textarea = document.getElementById('new-note');
        const dateInput = document.getElementById('note-date-input');
        const content = textarea.value.trim();
        const date = dateInput.value;
        if (!content || !date) return;

        const newNote = {
            id: Date.now(),
            content: content,
            date: date
        };

        appData.notes.push(newNote);
        saveData();
        textarea.value = '';
        // Keep the date for easy multiple entries
        loadNotesTab();
        updateDashboard();
    }

    function editNote(noteId) {
        const note = appData.notes.find(note => note.id === noteId);
        if (!note) return;

        const newContent = prompt('Edit note:', note.content);
        if (newContent === null) return;
        
        const newDate = prompt('Edit date (YYYY-MM-DD):', note.date);
        if (newDate === null) return;

        if (newContent.trim() !== '' && newDate) {
            note.content = newContent.trim();
            note.date = newDate;
            saveData();
            loadNotesTab();
            updateDashboard();
        }
    }

    function deleteNote(noteId) {
        if (confirm('Delete this note?')) {
            appData.notes = appData.notes.filter(note => note.id !== noteId);
            saveData();
            loadNotesTab();
            updateDashboard();
        }
    }

    // Load calories tab - SIMPLE VERSION
    function loadCaloriesTab() {
        const contentArea = document.getElementById('content-area');
        
        // Get today's date and yesterday's date
        const today = new Date().toISOString().split('T')[0];
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        
        // Get burned calories for today (if any)
        const todayBurned = appData.caloriesBurned?.find(entry => entry.date === today);
        const yesterdayBurned = appData.caloriesBurned?.find(entry => entry.date === yesterdayStr);
        
        contentArea.innerHTML = 
            '<h2>CALORIES</h2>' +
            
            // Daily burned calories entry
            '<div style="background: #f0f9ff; border: 1px solid #0284c7; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem;">' +
                '<h3 style="margin-bottom: 0.5rem; color: #0284c7;">Daily Calories Burned</h3>' +
                '<div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">' +
                    '<input type="number" id="burned-calories-input" placeholder="Total calories burned" value="' + (todayBurned?.burned || '') + '" style="flex: 1; min-width: 200px;">' +
                    '<input type="date" id="burned-date-input" value="' + today + '" style="flex: 0 0 auto;">' +
                    '<button class="btn btn-primary" onclick="addBurnedCalories()">Save</button>' +
                '</div>' +
                (yesterdayBurned ? '<small style="color: #0284c7;">Yesterday: ' + yesterdayBurned.burned + ' calories burned</small>' : '<small style="color: #6b7280;">Tip: Usually enter previous day\'s data from Apple Watch</small>') +
            '</div>' +
            
            // Weekly summaries
            getWeeklySummariesHTML() +
            
            // Food entries
            '<h3 style="margin-bottom: 1rem;">Food Log</h3>' +
            '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem;">' +
                '<input type="text" id="food-input" placeholder="Food item">' +
                '<input type="number" id="calories-input" placeholder="Calories">' +
                '<input type="number" id="protein-input" placeholder="Protein (g)">' +
                '<select id="meal-input">' +
                    '<option value="breakfast">Breakfast</option>' +
                    '<option value="lunch">Lunch</option>' +
                    '<option value="dinner">Dinner</option>' +
                    '<option value="snack">Snack</option>' +
                '</select>' +
                '<input type="date" id="calorie-date-input" value="' + new Date().toISOString().split('T')[0] + '">' +
                '<button class="btn btn-green" onclick="addCalorieEntry()">Add</button>' +
            '</div>' +
            '<div>' +
                appData.calories
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .map(entry => 
                    '<div style="padding: 1rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">' +
                        '<div style="cursor: pointer;" onclick="editCalorieEntry(' + entry.id + ')">' +
                            '<strong>' + entry.food + '</strong> - ' + entry.calories + ' cal' +
                            (entry.protein ? ', ' + entry.protein + 'g protein' : '') +
                            ' (' + entry.meal + ')' +
                            '<br><small style="color: #6b7280;">' + new Date(entry.date).toLocaleDateString() + '</small>' +
                        '</div>' +
                        '<button class="btn btn-delete" onclick="deleteCalorieEntry(' + entry.id + ')">Delete</button>' +
                    '</div>'
                ).join('') +
            '</div>';
    }

    function addCalorieEntry() {
        const food = document.getElementById('food-input').value.trim();
        const calories = parseInt(document.getElementById('calories-input').value);
        const protein = parseInt(document.getElementById('protein-input').value) || 0;
        const meal = document.getElementById('meal-input').value;
        const date = document.getElementById('calorie-date-input').value;

        if (!food || !calories || !date) return;

        const newEntry = {
            id: Date.now(),
            food: food,
            calories: calories,
            protein: protein,
            meal: meal,
            date: date
        };

        appData.calories.push(newEntry);
        saveData();
        
        document.getElementById('food-input').value = '';
        document.getElementById('calories-input').value = '';
        document.getElementById('protein-input').value = '';
        // Keep the date as is for easy multiple entries
        loadCaloriesTab();
        updateDashboard();
    }

    function editCalorieEntry(entryId) {
        const entry = appData.calories.find(entry => entry.id === entryId);
        if (!entry) return;

        const newFood = prompt('Edit food:', entry.food);
        if (!newFood) return;
        
        const newCalories = prompt('Edit calories:', entry.calories);
        if (!newCalories) return;

        const newProtein = prompt('Edit protein:', entry.protein || '');
        
        const newDate = prompt('Edit date (YYYY-MM-DD):', entry.date);
        if (!newDate) return;

        entry.food = newFood;
        entry.calories = parseInt(newCalories);
        entry.protein = parseInt(newProtein) || 0;
        entry.date = newDate;
        saveData();
        loadCaloriesTab();
        updateDashboard();
    }

    function addBurnedCalories() {
        const burned = parseInt(document.getElementById('burned-calories-input').value);
        const date = document.getElementById('burned-date-input').value;

        if (!burned || !date) return;

        // Initialize caloriesBurned array if it doesn't exist
        if (!appData.caloriesBurned) appData.caloriesBurned = [];

        // Check if entry for this date already exists
        const existingIndex = appData.caloriesBurned.findIndex(entry => entry.date === date);
        
        if (existingIndex >= 0) {
            // Update existing entry
            appData.caloriesBurned[existingIndex].burned = burned;
        } else {
            // Add new entry
            const newEntry = {
                id: Date.now(),
                burned: burned,
                date: date
            };
            appData.caloriesBurned.push(newEntry);
        }

        saveData();
        loadCaloriesTab();
        updateDashboard();
    }

    function getWeeklySummariesHTML() {
        if (!appData.caloriesBurned) appData.caloriesBurned = [];
        
        // Get all unique weeks with complete data
        const weeks = getCompleteWeeks();
        
        if (weeks.length === 0) {
            return '<div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem;">' +
                   '<h3 style="margin-bottom: 0.5rem; color: #92400e;">Weekly Summaries</h3>' +
                   '<p style="color: #92400e; margin: 0;">Add burned calories data to see weekly summaries!</p>' +
                   '</div>';
        }
        
        let html = '<div style="background: #f0fdf4; border: 1px solid #22c55e; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem;">' +
                  '<h3 style="margin-bottom: 1rem; color: #166534;">Weekly Summaries</h3>';
        
        weeks.slice(0, 6).forEach(week => { // Show last 6 weeks max
            const weekTotal = week.days.reduce((sum, day) => sum + day.balance, 0);
            const weekAvg = Math.round(weekTotal / week.days.length);
            const deficitDays = week.days.filter(day => day.balance < 0).length;
            const surplusDays = week.days.filter(day => day.balance > 0).length;
            
            let weekColor = '#22c55e'; // green for deficit
            let weekIcon = '‚úÖ';
            if (weekAvg > 100) {
                weekColor = '#ef4444'; // red for surplus
                weekIcon = '‚ö†Ô∏è';
            } else if (weekAvg >= -100) {
                weekColor = '#f59e0b'; // yellow for maintenance
                weekIcon = '‚öñÔ∏è';
            }
            
            html += '<div style="margin-bottom: 0.75rem; padding: 0.75rem; background: white; border-radius: 0.375rem; border-left: 4px solid ' + weekColor + ';">' +
                   '<div style="font-weight: 600; color: ' + weekColor + ';">' + week.label + ': ' + (weekTotal > 0 ? '+' : '') + weekTotal + ' total (' + (weekAvg > 0 ? '+' : '') + weekAvg + ' avg/day) ' + weekIcon + '</div>' +
                   '<div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">' + deficitDays + ' deficit days, ' + surplusDays + ' surplus days</div>' +
                   '</div>';
        });
        
        html += '</div>';
        return html;
    }

    function getCompleteWeeks() {
        const weeks = [];
        const today = new Date();
        
        // Go back up to 8 weeks
        for (let weekOffset = 1; weekOffset <= 8; weekOffset++) {
            const weekEnd = new Date(today);
            weekEnd.setDate(today.getDate() - (weekOffset - 1) * 7);
            weekEnd.setDate(weekEnd.getDate() - weekEnd.getDay()); // Last Sunday
            
            const weekStart = new Date(weekEnd);
            weekStart.setDate(weekEnd.getDate() - 6); // Previous Monday
            
            const weekData = {
                start: weekStart,
                end: weekEnd,
                label: formatWeekLabel(weekStart, weekEnd),
                days: []
            };
            
            // Check each day of the week
            let hasCompleteData = true;
            for (let dayOffset = 0; dayOffset < 7; dayOffset++) {
                const day = new Date(weekStart);
                day.setDate(weekStart.getDate() + dayOffset);
                const dayStr = day.toISOString().split('T')[0];
                
                const consumedCals = appData.calories
                    .filter(entry => entry.date === dayStr)
                    .reduce((sum, entry) => sum + entry.calories, 0);
                
                const burnedEntry = appData.caloriesBurned?.find(entry => entry.date === dayStr);
                const burnedCals = burnedEntry?.burned || 0;
                
                if (burnedCals === 0) {
                    hasCompleteData = false;
                    break;
                }
                
                weekData.days.push({
                    date: dayStr,
                    consumed: consumedCals,
                    burned: burnedCals,
                    balance: consumedCals - burnedCals
                });
            }
            
            if (hasCompleteData) {
                weeks.push(weekData);
            }
        }
        
        return weeks;
    }

    function deleteCalorieEntry(entryId) {
        if (confirm('Delete this entry?')) {
            appData.calories = appData.calories.filter(entry => entry.id !== entryId);
            saveData();
            loadCaloriesTab();
            updateDashboard();
        }
    }

    function formatWeekLabel(start, end) {
        const options = { month: 'short', day: 'numeric' };
        return 'Week of ' + start.toLocaleDateString('en-US', options) + '-' + end.toLocaleDateString('en-US', options);
    }

    // Load spending tab - SIMPLE VERSION
    function loadSpendingTab() {
        const contentArea = document.getElementById('content-area');
        
        contentArea.innerHTML = 
            '<h2>SPENDING</h2>' +
            '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">' +
                '<input type="text" id="description-input" placeholder="Description">' +
                '<input type="number" id="amount-input" step="0.01" placeholder="Amount">' +
                '<select id="category-input">' +
                    '<option value="food">Food</option>' +
                    '<option value="transport">Transport</option>' +
                    '<option value="entertainment">Entertainment</option>' +
                    '<option value="shopping">Shopping</option>' +
                    '<option value="other">Other</option>' +
                '</select>' +
                '<input type="date" id="spending-date-input" value="' + new Date().toISOString().split('T')[0] + '">' +
                '<button class="btn btn-primary" onclick="addSpendingEntry()">Add</button>' +
            '</div>' +
            '<div>' +
                appData.spending
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .map(entry => 
                    '<div style="padding: 1rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">' +
                        '<div style="cursor: pointer;" onclick="editSpendingEntry(' + entry.id + ')">' +
                            '<strong>' + entry.description + '</strong> - $' + entry.amount.toFixed(2) + ' (' + entry.category + ')' +
                            '<br><small style="color: #6b7280;">' + new Date(entry.date).toLocaleDateString() + '</small>' +
                        '</div>' +
                        '<button class="btn btn-delete" onclick="deleteSpendingEntry(' + entry.id + ')">Delete</button>' +
                    '</div>'
                ).join('') +
            '</div>';
    }

    function addSpendingEntry() {
        const description = document.getElementById('description-input').value.trim();
        const amount = parseFloat(document.getElementById('amount-input').value);
        const category = document.getElementById('category-input').value;
        const date = document.getElementById('spending-date-input').value;

        if (!description || !amount || !date) return;

        const newEntry = {
            id: Date.now(),
            description: description,
            amount: amount,
            category: category,
            date: date
        };

        appData.spending.push(newEntry);
        saveData();
        
        document.getElementById('description-input').value = '';
        document.getElementById('amount-input').value = '';
        // Keep the date as is for easy multiple entries
        loadSpendingTab();
        updateDashboard();
    }

    function editSpendingEntry(entryId) {
        const entry = appData.spending.find(entry => entry.id === entryId);
        if (!entry) return;

        const newDescription = prompt('Edit description:', entry.description);
        if (!newDescription) return;
        
        const newAmount = prompt('Edit amount:', entry.amount);
        if (!newAmount) return;

        const newDate = prompt('Edit date (YYYY-MM-DD):', entry.date);
        if (!newDate) return;

        entry.description = newDescription;
        entry.amount = parseFloat(newAmount);
        entry.date = newDate;
        saveData();
        loadSpendingTab();
        updateDashboard();
    }

    function deleteSpendingEntry(entryId) {
        if (confirm('Delete this entry?')) {
            appData.spending = appData.spending.filter(entry => entry.id !== entryId);
            saveData();
            loadSpendingTab();
            updateDashboard();
        }
    }

    // Update dashboard stats - SIMPLE VERSION
    function updateDashboard() {
        const today = new Date().toISOString().split('T')[0];
        const todayEntries = appData.calories.filter(entry => entry.date && entry.date.startsWith(today));
        const todayCalories = todayEntries.reduce((sum, entry) => sum + entry.calories, 0);
        const todayProtein = todayEntries.reduce((sum, entry) => sum + (entry.protein || 0), 0);
        
        // Get today's burned calories
        const todayBurned = appData.caloriesBurned?.find(entry => entry.date === today);
        const burnedCals = todayBurned?.burned || 0;
        
        // Calculate balance and update display
        let balanceText = 'Enter burned calories';
        let balanceColor = '#f59e0b'; // yellow/orange default
        
        if (burnedCals > 0) {
            const balance = todayCalories - burnedCals;
            if (balance < -100) {
                balanceText = balance + ' deficit ‚úÖ';
                balanceColor = '#22c55e'; // green
            } else if (balance > 100) {
                balanceText = '+' + balance + ' surplus ‚ö†Ô∏è';
                balanceColor = '#ef4444'; // red
            } else {
                balanceText = (balance >= 0 ? '+' : '') + balance + ' maintenance ‚öñÔ∏è';
                balanceColor = '#f59e0b'; // yellow
            }
        }
        
        document.getElementById('calories-today').textContent = todayCalories + ' cal today';
        document.getElementById('protein-today').textContent = todayProtein + 'g protein';
        document.getElementById('balance-today').textContent = balanceText;
        document.getElementById('balance-today').style.color = balanceColor;

        const now = new Date();
        const weekStart = new Date(now);
        weekStart.setDate(weekStart.getDate() - weekStart.getDay());
        
        const weekSpending = appData.spending
            .filter(entry => {
                if (!entry.date) return false;
                const entryDate = new Date(entry.date);
                return entryDate >= weekStart;
            })
            .reduce((sum, entry) => sum + entry.amount, 0);
        
        document.getElementById('spending-week').textContent = '$' + weekSpending.toFixed(2) + ' this week';
    }

    // Download data as JSON
    function downloadData() {
        const dataStr = JSON.stringify(appData, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'notebook-data.json';
        link.click();
        URL.revokeObjectURL(url);
    }

    // Upload data from JSON file
    function uploadData(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                
                // Merge lists
                if (importedData.lists) {
                    Object.keys(importedData.lists).forEach(listName => {
                        if (!appData.lists[listName]) appData.lists[listName] = [];
                        importedData.lists[listName].forEach(item => {
                            // Only add if not already exists (check by content and date)
                            const exists = appData.lists[listName].some(existing => 
                                existing.content === item.content && existing.date === item.date
                            );
                            if (!exists) {
                                appData.lists[listName].push({...item, id: Date.now() + Math.random()});
                            }
                        });
                    });
                }
                
                // Merge notes
                if (importedData.notes) {
                    importedData.notes.forEach(note => {
                        const exists = appData.notes.some(existing => 
                            existing.content === note.content && existing.date === note.date
                        );
                        if (!exists) {
                            appData.notes.push({...note, id: Date.now() + Math.random()});
                        }
                    });
                }
                
                // Merge calories
                if (importedData.calories) {
                    importedData.calories.forEach(entry => {
                        const exists = appData.calories.some(existing => 
                            existing.food === entry.food && existing.date === entry.date && existing.calories === entry.calories
                        );
                        if (!exists) {
                            appData.calories.push({...entry, id: Date.now() + Math.random()});
                        }
                    });
                }
                
                // Merge burned calories
                if (importedData.caloriesBurned) {
                    importedData.caloriesBurned.forEach(entry => {
                        const exists = appData.caloriesBurned.some(existing => 
                            existing.date === entry.date
                        );
                        if (!exists) {
                            appData.caloriesBurned.push({...entry, id: Date.now() + Math.random()});
                        }
                    });
                }
                
                // Merge spending
                if (importedData.spending) {
                    importedData.spending.forEach(entry => {
                        const exists = appData.spending.some(existing => 
                            existing.description === entry.description && existing.date === entry.date && existing.amount === entry.amount
                        );
                        if (!exists) {
                            appData.spending.push({...entry, id: Date.now() + Math.random()});
                        }
                    });
                }
                
                saveData();
                updateDashboard();
                alert('Data imported successfully!');
                showTab('dashboard'); // Refresh to show updated data
            } catch (error) {
                alert('Error importing data: ' + error.message);
            }
        };
        reader.readAsText(file);
        
        // Clear the input so the same file can be uploaded again
        event.target.value = '';
    }

    // Initialize app
    loadData();
    showTab('dashboard');
    updateDashboard();
</script>
```

</body>
</html>
